~ "variable-length-quantity.ua" ~ VariableLengthQuantity

# Zero
⍤⤙≍ [0x0uy] encode [0x0u]

# Arbitrary single byte
⍤⤙≍ [0x40uy] encode [0x40u]

# Largest single byte
⍤⤙≍ [0x7fuy] encode [0x7fu]

# Smallest double byte
⍤⤙≍ [0x81uy 0x0uy] encode [0x80u]

# Arbitrary double byte
⍤⤙≍ [0xc0uy 0x0uy] encode [0x2000u]

# Largest double byte
⍤⤙≍ [0xffuy 0x7fuy] encode [0x3fffu]

# Smallest triple byte
⍤⤙≍ [0x81uy 0x80uy 0x0uy] encode [0x4000u]

# Arbitrary triple byte
⍤⤙≍ [0xc0uy 0x80uy 0x0uy] encode [0x100000u]

# Largest triple byte
⍤⤙≍ [0xffuy 0xffuy 0x7fuy] encode [0x1fffffu]

# Smallest quadruple byte
⍤⤙≍ [0x81uy 0x80uy 0x80uy 0x0uy] encode [0x200000u]

# Arbitrary quadruple byte
⍤⤙≍ [0xc0uy 0x80uy 0x80uy 0x0uy] encode [0x8000000u]

# Largest quadruple byte
⍤⤙≍ [0xffuy 0xffuy 0xffuy 0x7fuy] encode [0xfffffffu]

# Smallest quintuple byte
⍤⤙≍ [0x81uy 0x80uy 0x80uy 0x80uy 0x0uy] encode [0x10000000u]

# Arbitrary quintuple byte
⍤⤙≍ [0x8fuy 0xf8uy 0x80uy 0x80uy 0x0uy] encode [0xff000000u]

# Maximum 32-bit integer input
⍤⤙≍ [0x8fuy 0xffuy 0xffuy 0xffuy 0x7fuy] encode [0xffffffffu]

# Two single-byte values
⍤⤙≍ [0x40uy 0x7fuy] encode [0x40u 0x7fu]

# Two multi-byte values
⍤⤙≍ [0x81uy 0x80uy 0x0uy 0xc8uy 0xe8uy 0x56uy] encode [0x4000u 0x123456u]

# Many multi-byte values
⍤⤙≍ [0xc0uy 0x0uy 0xc8uy 0xe8uy 0x56uy 0xffuy 0xffuy 0xffuy 0x7fuy 0x0uy 0xffuy 0x7fuy 0x81uy 0x80uy 0x0uy] encode [0x2000u 0x123456u 0xfffffffu 0x0u 0x3fffu 0x4000u]

# One byte
⍤⤙≍ [0x7fu] decode [0x7fuy]

# Two bytes
⍤⤙≍ [0x2000u] decode [0xc0uy 0x0uy]

# Three bytes
⍤⤙≍ [0x1fffffu] decode [0xffuy 0xffuy 0x7fuy]

# Four bytes
⍤⤙≍ [0x200000u] decode [0x81uy 0x80uy 0x80uy 0x0uy]

# Maximum 32-bit integer
⍤⤙≍ [0xffffffffu] decode [0x8fuy 0xffuy 0xffuy 0xffuy 0x7fuy]

# Incomplete sequence causes error
⍤⤙≍ "TODO: insert error message" ⍣(decode [0xffuy])

# Incomplete sequence causes error, even if value is zero
⍤⤙≍ "TODO: insert error message" ⍣(decode [0x80uy])

# Multiple values
⍤⤙≍ [0x2000u 0x123456u 0xfffffffu 0x0u 0x3fffu 0x4000u] decode [0xc0uy 0x0uy 0xc8uy 0xe8uy 0x56uy 0xffuy 0xffuy 0xffuy 0x7fuy 0x0uy 0xffuy 0x7fuy 0x81uy 0x80uy 0x0uy]

